<div class="header">

  <h4>{{ 'INCIDENTS.INCIDENTS' | translate }}</h4>

  <mat-form-field appearance="outline" class="search-bar">
    <mat-label>{{ 'INCIDENTS.SEARCH-BY' | translate }}</mat-label>
    <input matInput [(ngModel)]="query" placeholder="{{ 'INCIDENTS.SEARCH-EXAMPLE' | translate }}">
  </mat-form-field>

  <mat-form-field appearance="outline" class="filter-bar">
    <mat-label>{{ 'INCIDENTS.MODEL' | translate }}</mat-label>
    <mat-select [(ngModel)]="modelFilter">
      <mat-option *ngFor="let m of models()" [value]="m">{{ m }}</mat-option>
    </mat-select>
  </mat-form-field>

  <button mat-raised-button color="primary" (click)="newIncident()">
    <mat-icon>add</mat-icon>&nbsp;{{ 'INCIDENTS.NEW-INCIDENT' | translate }}
  </button>

</div>

<ng-container *ngIf="isLoading(); else list">
  <div class="grid">
    <div class="skeleton" style="height:160px"></div>
    <div class="skeleton" style="height:160px"></div>
    <div class="skeleton" style="height:160px"></div>
  </div>
</ng-container>

<ng-template #list>
  <div *ngIf="filtered().length === 0" class="app-card empty">
    <mat-icon>find_in_page</mat-icon>
    <div class="app-section-title">{{ 'INCIDENTS.NO-RESULTS' | translate }}</div>

    <div>{{ 'INCIDENTS.ADJUST-SEARCH' | translate }}</div>
  </div>

  <div class="grid">
    <mat-card class="app-card" *ngFor="let i of filtered(); trackBy: trackById">
      <mat-card-header>
        <div mat-card-avatar><mat-icon>confirmation_number</mat-icon></div>
        <mat-card-title style="font-weight:800;">
          {{ ('INC-' + i.id) }}
        </mat-card-title>
        <mat-card-subtitle>{{ i.model }}</mat-card-subtitle>
      </mat-card-header>

      <mat-card-content>
        <div class="row">
          <div><strong>{{ 'INCIDENTS.SERIAL' | translate }}: </strong> {{ i.serial }}</div>
          <div><strong>{{ 'INCIDENTS.DATE' | translate }}: </strong> {{ i.date | date:'dd/MM/yyyy' }}</div>
          <div class="full">
            <strong>{{ 'INCIDENTS.DESCRIPTION' | translate }}:</strong>
            <div>{{ i.description }}</div>
          </div>
        </div>
      </mat-card-content>

      <mat-card-actions class="actions">
        <mat-chip-set>
          <mat-chip [color]="stateColor(i.state)" selected>{{ i.state }}</mat-chip>
        </mat-chip-set>
        <button mat-stroked-button style="margin-left: 20px">
          <mat-icon>visibility</mat-icon>&nbsp;{{ 'INCIDENTS.DETAILS' | translate }}
        </button>
      </mat-card-actions>
    </mat-card>
  </div>
</ng-template>
